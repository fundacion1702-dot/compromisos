<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Compromisos</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#F2F3F5"/>

  <!-- iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Compromisos">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- CSS separado -->
  <link rel="stylesheet" href="compromisos.css?v=1">

  <!-- âœ… Evitar que el tÃ­tulo/subtÃ­tulo â€œdesaparezcanâ€ con texto grande -->
  <style>
    @media (max-width:520px){
      .title, .subtitle{
        white-space: normal !important;
        overflow: hidden !important;
        text-overflow: clip !important;
        display: -webkit-box !important;
        -webkit-box-orient: vertical !important;
        -webkit-line-clamp: 2 !important;
      }
    }
    body.bigText .title,
    body.bigText .subtitle{
      white-space: normal !important;
      overflow: hidden !important;
      text-overflow: clip !important;
      display: -webkit-box !important;
      -webkit-box-orient: vertical !important;
      -webkit-line-clamp: 2 !important;
    }

    /* âœ… Ajustes: icono pequeÃ±o (rueda) */
    .gearBtn{
      width:38px;
      height:38px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--surface2);
      box-shadow:var(--shadow2);
      display:grid;
      place-items:center;
      cursor:pointer;
      -webkit-tap-highlight-color:transparent;
      font-size:18px;
      line-height:1;
    }
    .gearBtn:active{ transform:translateY(1px); }
  </style>
</head>

<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="topbarInner">
      <div class="brand" role="banner" aria-label="Compromisos">
        <div class="logo" aria-hidden="true"><span>ğŸ—“ï¸</span></div>
        <div class="titleBox">
          <p class="title">Compromisos</p>
          <p class="subtitle" id="statsKicker">Todo en tarjetas, mÃ¡s visual.</p>
        </div>
      </div>

      <!-- Accesibilidad arriba derecha + pills + âš™ï¸ ajustes pequeÃ±o -->
      <div class="topActions">
        <button class="a11yBtn" id="btnA11yTop" type="button" title="Cambiar tamaÃ±o de letra">ğŸ” Texto grande</button>

        <!-- âœ… Ajustes pasa a un icono pequeÃ±o -->
        <button class="gearBtn" id="btnSettingsGear" type="button" title="Ajustes" aria-label="Ajustes">âš™ï¸</button>

        <div class="pills" aria-label="Indicadores">
          <!-- âœ… Orden pedido: Recibidos a la izquierda, Vencidos a la derecha -->
          <button class="pillBtn good" id="btnReceived" type="button" title="Recibidos">
            <span class="pillDot" aria-hidden="true"></span>
            <span>Recibidos</span>
            <span class="pillCount" id="bReceived">0</span>
          </button>

          <button class="pillBtn danger" id="btnOverdue" type="button" title="Vencidos">
            <span class="pillDot" aria-hidden="true"></span>
            <span>Vencidos</span>
            <span class="pillCount" id="bOverdue">0</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- MenÃº visual -->
    <div class="menuGrid" aria-label="MenÃº">
      <div class="tile" id="tilePending" role="button" tabindex="0">
        <div class="tileIcon"><span>ğŸ“</span></div>
        <div class="tileText">
          <p class="tileTitle">Pendientes</p>
          <p class="tileMeta">
            <span class="badge primary" id="tilePendingCount">0</span>
            <span>compromisos</span>
          </p>
        </div>
      </div>

      <!-- âœ… NUEVO: En espera (sustituye al tile de Ajustes) -->
      <div class="tile" id="tileWaiting" role="button" tabindex="0">
        <div class="tileIcon"><span>â³</span></div>
        <div class="tileText">
          <p class="tileTitle">En espera</p>
          <p class="tileMeta">
            <span class="badge" id="tileWaitingCount">0</span>
            <span>pend. respuesta</span>
          </p>
        </div>
      </div>

      <div class="tile" id="tileDone" role="button" tabindex="0">
        <div class="tileIcon"><span>âœ…</span></div>
        <div class="tileText">
          <p class="tileTitle">Cerrados</p>
          <p class="tileMeta">
            <span class="badge good" id="tileDoneCount">0</span>
            <span>finalizados</span>
          </p>
        </div>
      </div>

      <div class="tile" id="tileContacts" role="button" tabindex="0">
        <div class="tileIcon"><span>ğŸ‘¥</span></div>
        <div class="tileText">
          <p class="tileTitle">Amigos</p>
          <p class="tileMeta">
            <span class="badge" id="tileContactsCount">0</span>
            <span>guardados</span>
          </p>
        </div>
      </div>
    </div>

    <!-- PANE: COMPROMISOS -->
    <div id="commitmentsPane" class="section" style="margin-top:14px;">
      <div class="sectionHead">
        <div>
          <h2>Compromisos</h2>
          <p>Todo ordenado y fÃ¡cil de ver.</p>
        </div>

        <!-- âœ… Ahora 3 estados -->
        <div class="segTabs" role="tablist" aria-label="Pendientes, En espera o Cerrados">
          <button class="segBtn active" id="tabPending" type="button">Pendientes</button>
          <button class="segBtn" id="tabWaiting" type="button">En espera</button>
          <button class="segBtn" id="tabDone" type="button">Cerrados</button>
        </div>
      </div>

      <div class="list" id="list"></div>
      <div class="empty" id="empty">No hay compromisos aquÃ­ todavÃ­a.</div>
    </div>

    <!-- PANE: CONTACTOS -->
    <div id="contactsPane" class="section" style="display:none;">
      <div class="sectionHead">
        <div>
          <h2>Amigos</h2>
          <p>Toca una tarjeta para crear un compromiso con ese amigo.</p>
        </div>
        <div class="segTabs">
          <span class="badge" id="bContacts">0</span>
        </div>
      </div>

      <div class="list" id="contactsList"></div>
      <div class="empty" id="contactsEmpty">AÃºn no has creado amigos.</div>
    </div>

    <!-- PANE: SETTINGS -->
    <div id="settingsPane" class="section" style="display:none;">
      <div class="sectionHead">
        <div>
          <h2>Ajustes</h2>
          <p>Bloqueo, notificaciones y accesibilidad.</p>
        </div>
      </div>

      <div class="list" style="gap:12px;">
        <!-- Accesibilidad -->
        <div class="card">
          <div class="cardTop">
            <div class="who">
              <p class="name">Accesibilidad</p>
              <p class="meta"><span class="chip">ğŸ‘ï¸ Texto grande</span></p>
            </div>
            <div class="due">Ajuste</div>
          </div>
          <div class="actions">
            <button class="btn primary" id="btnA11y" type="button">ğŸ” Texto grande</button>
          </div>
        </div>

        <!-- PIN -->
        <div class="card">
          <div class="cardTop">
            <div class="who">
              <p class="name">Bloqueo con PIN</p>
              <p class="meta">
                <span class="chip">ğŸ”’ Seguridad</span>
                <span class="chip">Auto-bloqueo</span>
              </p>
            </div>
            <div class="switch" id="swPin" role="switch" aria-checked="false" tabindex="0" aria-label="Activar PIN">
              <span class="knob"></span>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="btnChangePin" type="button">ğŸ” Cambiar PIN</button>
            <button class="btn danger" id="btnLockNow" type="button">ğŸ”’ Bloquear ahora</button>
          </div>

          <div class="field" style="margin-top:10px;">
            <label class="label" for="selAutoLock">Auto-bloqueo al salir</label>
            <select id="selAutoLock">
              <option value="0">Inmediato</option>
              <option value="1">1 min</option>
              <option value="2">2 min</option>
              <option value="5">5 min</option>
              <option value="10">10 min</option>
            </select>
            <div class="hint">Se aplica cuando sales de la app o la minimizas.</div>
          </div>

          <div class="field">
            <label class="label" for="selRemember">Recordar desbloqueo</label>
            <select id="selRemember">
              <option value="0">No recordar</option>
              <option value="5">5 min</option>
              <option value="10">10 min</option>
              <option value="30">30 min</option>
              <option value="60">1 hora</option>
            </select>
            <div class="hint">Si lo activas, no te pedirÃ¡ el PIN durante ese tiempo.</div>
          </div>
        </div>

