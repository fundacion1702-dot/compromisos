<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Compromisos</title>
  <meta name="theme-color" content="#6b5bff"/>
  <link rel="manifest" href="manifest.webmanifest">

  <style>
    :root{
      --bg:#0b0c12;
      --surface:#121427;
      --surface2:#171a33;
      --text:#e9ecff;
      --muted:#aab0d6;
      --primary:#6b5bff;
      --primary2:#8a7dff;
      --good:#36d399;
      --bad:#ff5c7a;
      --warn:#ffcc66;
      --stroke:rgba(255,255,255,.10);
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --r:18px;

      --fs-base: 16px;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-size: var(--fs-base);
      font-family:
        system-ui, -apple-system, Segoe UI, Roboto, Arial,
        "Noto Color Emoji", "Segoe UI Emoji", "Apple Color Emoji",
        "Noto Emoji", sans-serif;
      background: radial-gradient(1000px 600px at 20% -10%, rgba(107,91,255,.35), transparent 60%),
                  radial-gradient(800px 600px at 90% 0%, rgba(255,204,102,.15), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      padding-bottom:96px;
    }

    .wrap{ max-width:560px; margin:0 auto; padding:16px 14px 0; }

    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:6px;
    }

    .brand{ display:flex; align-items:center; gap:10px; min-width:0; }

    .logo{
      width:44px;height:44px;border-radius:15px; display:grid;place-items:center;
      background: linear-gradient(135deg, rgba(107,91,255,.95), rgba(138,125,255,.70));
      box-shadow: 0 12px 30px rgba(107,91,255,.25);
      border:1px solid rgba(255,255,255,.14);
      flex:0 0 auto; font-weight:950; letter-spacing:.5px;
      font-size: 18px;
    }

    .brand h1{
      margin:0; font-size:20px; line-height:1.1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .brand p{
      margin:2px 0 0; font-size:13.5px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }

    .iconbtn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius: 14px;
      padding: 11px 12px;
      cursor:pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
      transition: transform .08s ease, background .15s ease;
      display:flex; align-items:center; gap:8px;
      font-weight:900;
      font-size: 14px;
    }
    .iconbtn:active{ transform: scale(.98); }
    .iconbtn small{ color:var(--muted); font-weight:800; font-size: 12.5px; }

    .hero{
      margin-top: 14px;
      padding: 14px;
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
    }
    .hero .row{ display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap; }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(107,91,255,.14);
      color: var(--text);
      font-size: 13px;
      font-weight: 850;
      white-space:nowrap;
    }
    .hero h2{ margin: 10px 0 6px; font-size: 18px; line-height:1.25; }
    .hero p{ margin: 0; color: var(--muted); font-size: 15px; line-height:1.4; }

    .banner{
      margin-top: 12px;
      padding: 12px;
      border-radius: var(--r);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      box-shadow: 0 12px 30px rgba(0,0,0,.18);
      display:none;
    }
    .banner.show{ display:block; }
    .banner .title{ font-weight:950; margin:0 0 6px; font-size: 16px; }
    .banner .txt{ margin:0; color:var(--muted); font-size:14.5px; line-height:1.35; }
    .banner .row{ display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; }

    .btn{
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 11px 12px;
      cursor:pointer;
      font-weight: 950;
      font-size: 15px;
      transition: transform .08s ease, background .15s ease;
      display:flex; align-items:center; justify-content:center; gap:8px;
      flex:1;
    }
    .btn:active{ transform: scale(.99); }

    .btn.primary{
      background: linear-gradient(135deg, rgba(107,91,255,.95), rgba(138,125,255,.55));
      border-color: rgba(255,255,255,.16);
    }
    .btn.good{
      background: linear-gradient(135deg, rgba(54,211,153,.95), rgba(54,211,153,.55));
      border-color: rgba(255,255,255,.16);
      color:#06150f;
    }
    .btn.danger{
      background: rgba(255,92,122,.12);
      border-color: rgba(255,92,122,.35);
    }
    .btn.ghost{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.12);
    }

    .tabs{
      margin-top: 14px;
      display:flex; gap:10px; padding: 6px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      box-shadow: 0 10px 25px rgba(0,0,0,.15);
    }
    .tab{
      flex:1;
      border:1px solid transparent;
      background: transparent;
      color: var(--muted);
      padding: 11px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 950;
      font-size: 15px;
      display:flex; align-items:center; justify-content:center; gap:8px;
      min-width: 0;
      white-space:nowrap;
    }
    .tab.active{
      color: var(--text);
      background: linear-gradient(135deg, rgba(107,91,255,.85), rgba(138,125,255,.55));
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 12px 30px rgba(107,91,255,.22);
    }
    .badge{
      display:inline-grid; place-items:center;
      min-width: 24px;
      padding: 2px 9px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 950;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
    }

    .subtabs{
      margin-top: 12px;
      display:flex; gap:10px; padding: 6px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
    }
    .subtab{
      flex:1;
      border:1px solid transparent;
      background: transparent;
      color: var(--muted);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 950;
      font-size: 14.5px;
      display:flex; align-items:center; justify-content:center; gap:8px;
    }
    .subtab.active{
      color: var(--text);
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.10);
    }

    .list{ margin-top: 14px; display:flex; flex-direction:column; gap: 10px; }

    .card{
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      border:1px solid var(--stroke);
      padding: 12px;
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
    }
    .cardTop{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }
    .who{ min-width:0; }
    .who .name{
      margin:0; font-size: 16px; font-weight: 950; letter-spacing:.2px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .who .meta{
      margin: 4px 0 0; font-size: 13px; color: var(--muted);
      display:flex; gap:8px; flex-wrap:wrap;
    }
    .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding: 4px 9px; border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-weight: 850;
      font-size: 12.5px;
    }
    .due{
      font-size: 13.5px;
      font-weight: 950;
      padding: 7px 11px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,204,102,.12);
      color: var(--text);
      white-space:nowrap;
    }
    .due.bad{ background: rgba(255,92,122,.14); }

    .desc{
      margin: 10px 0 0;
      font-size: 15px;
      line-height:1.35;
      color: var(--text);
      opacity: .95;
      word-break: break-word;
    }

    .actions{ margin-top: 10px; display:flex; gap: 10px; flex-wrap:wrap; }
    .actions .btn{ flex: 1; min-width: 120px; }
    .actions .btn.icon{ flex: 0 0 auto; min-width: 58px; }

    .empty{
      padding: 18px 14px;
      border-radius: var(--r);
      border: 1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      text-align:center;
      line-height:1.35;
      display:none;
      font-size: 15px;
    }

    .fab{
      position: fixed;
      right: 16px;
      bottom: 18px;
      width: 62px;
      height: 62px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,.16);
      background: linear-gradient(135deg, rgba(107,91,255,.95), rgba(138,125,255,.55));
      box-shadow: 0 18px 45px rgba(107,91,255,.25), 0 14px 40px rgba(0,0,0,.35);
      color: white;
      font-size: 30px;
      font-weight: 950;
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
      z-index: 50;
    }
    .fab:active{ transform: scale(.98); }

    /* Modal / Bottom Sheet */
    .backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 14px;
      z-index: 999;
    }
    .backdrop.show{ display:flex; }

    .sheet{
      width: min(560px, 100%);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(23,26,51,.98), rgba(18,20,39,.98));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 22px 60px rgba(0,0,0,.55);
      overflow:hidden;
    }

    .sheetHead{
      padding: 12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .sheetHead h3{ margin:0; font-size: 17px; font-weight: 950; letter-spacing:.2px; }

    .close{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 14px;
      padding: 9px 11px;
      cursor:pointer;
      font-weight: 950;
      font-size: 14px;
    }

    .sheetBody{ padding: 14px; display:flex; flex-direction:column; gap: 10px; }

    .field label{
      display:block;
      font-size: 13.5px;
      font-weight: 950;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .field input, .field textarea, .field select{
      width: 100%;
      padding: 13px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }
    .field textarea{ min-height: 92px; resize: vertical; }

    .hint{
      font-size: 13.5px;
      color: var(--muted);
      margin-top: 6px;
      line-height:1.35;
    }

    .sheetFoot{ padding: 12px 14px 14px; display:flex; gap: 10px; flex-wrap:wrap; }

    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 90px;
      background: rgba(0,0,0,.65);
      border: 1px solid rgba(255,255,255,.18);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,.45);
      font-weight: 850;
      font-size: 14px;
      display:none;
      z-index: 1000;
      max-width: calc(100% - 28px);
      text-align:center;
    }
    .toast.show{ display:block; }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:13px;
      color:var(--muted);
      word-break: break-all;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      padding:10px;
      border-radius:14px;
      margin-top:10px;
      display:none;
    }
    .mono.show{ display:block; }

    .kicker{
      font-size: 13px;
      color: var(--muted);
      margin: 10px 0 0;
    }

    /* Ajustes (switch) */
    .rowline{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 12px;
      border-radius: 16px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
      box-shadow: 0 10px 25px rgba(0,0,0,.12);
    }
    .rowline .ttl{ font-weight: 950; }
    .rowline .sub{ font-size: 13.5px; color: var(--muted); margin-top: 3px; line-height:1.25; }
    .stack{ display:flex; flex-direction:column; min-width:0; }
    .right{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }

    .switch{
      width: 52px;
      height: 32px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      position: relative;
      cursor:pointer;
      flex:0 0 auto;
    }
    .switch::after{
      content:"";
      position:absolute;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      background: rgba(255,255,255,.90);
      box-shadow: 0 10px 20px rgba(0,0,0,.35);
      transition: transform .18s ease, background .18s ease;
    }
    .switch.on{
      background: rgba(107,91,255,.35);
      border-color: rgba(255,255,255,.22);
    }
    .switch.on::after{
      transform: translateX(20px);
      background: rgba(255,255,255,.96);
    }

    /* Bloqueo (PIN) overlay */
    .lockOverlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 2000;
    }
    .lockOverlay.show{ display:flex; }
    .lockCard{
      width: min(420px, 100%);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(23,26,51,.98), rgba(18,20,39,.98));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 22px 60px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .lockHead{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .lockHead h3{ margin:0; font-size: 18px; font-weight: 950; }
    .lockHead p{ margin:6px 0 0; color: var(--muted); font-size: 14px; line-height:1.25; }
    .lockBody{ padding: 14px; display:flex; flex-direction:column; gap: 12px; }
    .pinDots{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-top: 2px;
    }
    .dot{
      width: 14px; height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
    }
    .dot.on{
      background: rgba(107,91,255,.85);
      border-color: rgba(255,255,255,.30);
      box-shadow: 0 10px 25px rgba(107,91,255,.22);
    }
    .keypad{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 6px;
    }
    .key{
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 14px 12px;
      font-size: 18px;
      font-weight: 950;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease;
      text-align:center;
    }
    .key:active{ transform: scale(.99); }
    .key.primary{
      background: linear-gradient(135deg, rgba(107,91,255,.95), rgba(138,125,255,.55));
      border-color: rgba(255,255,255,.18);
    }
    .key.danger{
      background: rgba(255,92,122,.12);
      border-color: rgba(255,92,122,.35);
    }
    .lockFoot{
      padding: 12px 14px 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    /* Selector corto/detallado en compartir */
    .seg{
      display:flex;
      gap:10px;
      padding: 6px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
    }
    .seg button{
      flex:1;
      border-radius: 14px;
      border:1px solid transparent;
      background: transparent;
      color: var(--muted);
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 950;
      font-size: 14.5px;
    }
    .seg button.active{
      color: var(--text);
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.12);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">C</div>
        <div style="min-width:0">
          <h1>Compromisos</h1>
          <p>Paquetes entre m칩viles 췅 sin base de datos</p>
        </div>
      </div>

      <button class="iconbtn" id="btnInstall" style="display:none">拘勇 <small>Instalar</small></button>
    </header>

    <section class="hero">
      <div class="row">
        <div class="pill">游논 Contactos</div>
        <div class="pill">游닍 Paquetes</div>
        <div class="pill">游댒 Recordatorios</div>
        <div class="pill">游 PIN</div>
      </div>
      <h2>Comparte cambios como un enlace (sin cuentas).</h2>
      <p>Ahora puedes activar <b>recordatorios</b> por fecha y a침adirlos al <b>calendario</b>.</p>
      <div class="mono" id="lastLink"></div>
      <div class="kicker" id="statsKicker" style="display:none"></div>
    </section>

    <!-- Banner inteligente (instalar / abrir en Chrome) -->
    <section class="banner" id="installBanner">
      <p class="title" id="installTitle">Inst치lala para usarla como app</p>
      <p class="txt" id="installText">
        Si la abres dentro de WhatsApp/Telegram, toca <b>Abrir en Chrome</b> para poder instalar.
      </p>
      <div class="row">
        <button class="btn primary" id="btnInstallBanner" style="display:none">拘勇 Instalar</button>
        <button class="btn primary" id="btnOpenChrome" style="display:none">游깷 Abrir en Chrome</button>
        <button class="btn" id="btnCopyLink" style="display:none">游늶 Copiar enlace</button>
        <button class="btn" id="btnHideBanner">Ocultar</button>
      </div>
    </section>

    <!-- Vista principal -->
    <nav class="tabs" aria-label="Vistas">
      <button class="tab active" id="tabCommitments">游닇 Compromisos</button>
      <button class="tab" id="tabContacts">游논 Amigos <span class="badge" id="bContacts">0</span></button>
      <button class="tab" id="tabSettings">丘뙖잺 Ajustes</button>
    </nav>

    <!-- Compromisos -->
    <div id="commitmentsPane">
      <nav class="subtabs" aria-label="Pesta침as">
        <button class="subtab active" id="tabPending">Pendientes <span class="badge" id="bPending">0</span></button>
        <button class="subtab" id="tabDone">Hechos <span class="badge" id="bDone">0</span></button>
      </nav>

      <div class="list" id="list"></div>
      <div class="empty" id="empty">No tienes compromisos aqu칤. Pulsa <b>+</b> para crear uno nuevo.</div>
    </div>

    <!-- Contactos -->
    <div id="contactsPane" style="display:none">
      <div class="list" id="contactsList"></div>
      <div class="empty" id="contactsEmpty">No tienes contactos a칰n. Pulsa <b>+</b> para crear el primero.</div>
    </div>

    <!-- Ajustes -->
    <div id="settingsPane" style="display:none">
      <div class="list">

        <div class="rowline">
          <div class="stack" style="min-width:0">
            <div class="ttl">游댒 Notificaciones</div>
            <div class="sub">Recordatorios locales (funcionan seguro cuando la app est치 abierta; en segundo plano depende del m칩vil).</div>
          </div>
          <div class="right">
            <div class="switch" id="swNotif" role="switch" aria-checked="false" tabindex="0"></div>
            <button class="btn" id="btnNotifPerm" style="flex:0 0 auto; min-width: 160px;">Permitir</button>
          </div>
        </div>

        <div class="rowline">
          <div class="stack" style="min-width:0">
            <div class="ttl">游 Bloqueo por PIN</div>
            <div class="sub">Protege la app con un PIN de 4 d칤gitos. Puedes 